<!DOCTYPE html>
<html>
<head>
<meta charset="EUC-KR">
<title>Insert title here</title>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script type="text/javascript">
	$(document).ready(function() {
		
		
		$("#send").click(function() {
			var frameData = $("#frm").serialize(); //name=홍길동&phone=010-1111-1111&addr=광주광역시
			$.ajax({
				url : "/webDesign/ajaxinsert", //AjaxInsertController
				type : "post",
				data : frameData,
				success : list,
				error : function() {
					alert("error");
				}
			});
			$("#cancel").trigger("click"); //중요
			$("#name").val("");
			$("#phone").val("");
			$("#addr").val("");

		});

		$("#register").click(function() {
			$("#input").css("visibility", "visible");
		});
		$("#btn").click(function() {
			list();
		});
	});
	function list() {
		$.ajax({
			url : "/webDesign/json",
			type : "get",
			dataType : "json",
			success : result,
			error : function() {
				alert("error");
			}
		});

	}
	//콜백함수
	function result(data) {
		//	alert(data);
		var str = "<table border='1'>";
		str += "<tr>";
		str += "<td>번호</td>";
		str += "<td>이름</td>";
		str += "<td>전화번호</td>";
		str += "<td>주소</td>";
		str += "<td>삭제</td>";
		str += "<td>수정</td>";
		str += "</tr>";
		// data는 닫는 table 위에서 작성 해줘야함
		$.each(data, function(index, obj) {
			str += "<tr>";
			str += "<td>" + obj.num + "</td>";
			str += "<td>" + obj.name + "</td>";
			str += "<td id='p" + obj.num + "'>" + obj.phone + "</td>";
			str += "<td id='a" + obj.num + "'>" + obj.addr + "</td>";
			str += "<td><input type='button' value='삭제'onclick='memdel(" + obj.num + ")'/></td>";
			str += "<td  id='u" + obj.num + "'><input type='button' value='수정'onclick='upform(" + obj.num + ")'/></td>";
			str += "</tr>";
		});
		str += "</table>";
		$("#list").html(str);
		$("#input").css("visibility", "hidden");
	}
	function upform(num) {
		
		var phone = $("#p"+num).text();
		var phoneinput="<input type = 'text' name = 'phone' id = 'phone"+num+"' value='"+phone+"'/>";
		$("#p"+num).html(phoneinput);
	
		var addr = $("#a"+num).text();
		var addrinput="<input type = 'text' name = 'addr' id = 'addr"+num+"' value='"+addr+"'/>";
		$("#a"+num).html(addrinput);
		
		var updatebtn="<input type='button' value='수정하기' onclick='memupdate("+num+")'/>";
	     $("#u"+num).html(updatebtn);   
	}
	function memupdate(num) {
		var phone = $("#phone"+num).val();
		var addr = $("#addr"+num).val();
		// alert(num+":"+phone+":"+addr);   
			$.ajax({
			url : "/webDesign/ajaxupdate",  //ajaxupdate --> AjaxUpdateController
			type : "post",  // 한글이 깨질 수 있기 때문에 get방식이 아닌 post 방식 
			data : {"num":num, "phone":phone, "addr":addr},    // dataType은 서버가 넘길때 내가 받는 타입
			success : list,
			error : function() {
				alert("error")
			}
		})
	}
	
	function memdel(num) {
		// alert(num); //ajaxdelete
		$.ajax({
			url : "/webDesign/ajaxdelete",  //AjaxDeleteController
			type : "get",
			data : {"num":num}, 
			success : list,
			error : function() {
				alert("error")
			}
		})
	}
	
	
</script>

</head>


<body>
	-회원리스트(Ajax)-
	<input type="button" , value="리스트가져오기" , id="btn" />
	<input type="button" , value="회원가입" , id="register" />
	<hr />
	<div id="list">여기에 회원리스트 출력</div>
	<div id="input" style="visibility: hidden;">
		<form id="frm">
			<table border="0">
				<tr>
					<td>이름</td>
					<td><input type="text" name="name" id="name" /></td>
				</tr>
				<tr>
					<td>전화번호</td>
					<td><input type="text" name="phone" id="phone" /></td>
				</tr>
				<tr>
					<td>주소</td>
					<td><input type="text" name="addr" id="addr" size="50" /> 
					<input type="button" value="위도경도구하기" id="mapbtn"/></td>
				</tr>
				 <tr>
					
				
				<tr>
					<td colspan="2" align="center"><input type="button" value="가입"
						id="send" /> <input type="reset" value="취소" id="cancel" /></td>
				</tr>
			</table>
		</form>
	</div>
</body>
</html>